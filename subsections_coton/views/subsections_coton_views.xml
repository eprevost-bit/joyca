<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_subsections_coton_form" model="ir.ui.view">
        <field name="name">subsections.coton.form</field>
        <field name="model">subsections.coton</field>
        <field name="arch" type="xml">
            <form string="SubsecciÃ³n">
                <sheet>
                    <group>
                        <field name="product_id"/>
                        <field name="name"/>
                        <field name="quantity"/>
                        <field name="price_unit"/>
                        <field name="subtotal" force_save="1" readonly="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_subsections_coton_tree" model="ir.ui.view">
        <field name="name">subsections.coton.tree</field>
        <field name="model">subsections.coton</field>
        <field name="arch" type="xml">
            <list string="Subsecciones" editable="bottom">
                <field name="product_id"/>
                <field name="name"/>
                <field name="quantity"/>
                <field name="price_unit"/>
                <field name="subtotal" force_save="1" readonly="1" sum="Total"/>
            </list>
        </field>
    </record>


    <record id="sale_order_view_form_inherit_subsections" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.subsections</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='order_line']/list/control/create[@name='add_product_control']"
                   position="before">
                <create name="add_subsection_control" string="Add Subsection"
                        context="{'default_is_subsection_line': True}"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/kanban/control/create[@name='add_product_control']"
                   position="before">
                <create name="add_subsection_control" string="Add Subsection"
                        context="{'default_is_subsection_line': True}"/>
            </xpath>

            <xpath expr="//field[@name='order_line']/form//group[1]/group[1]" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('is_subsection_line', '=', True),
                                                       ('display_type', 'in', ('line_section', 'line_note'))]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//group[1]/group[2]" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('is_subsection_line', '=', True),
                                                       ('display_type', 'in', ('line_section', 'line_note'))]}
                </attribute>
            </xpath>

            <xpath expr="//field[@name='order_line']/form/field[@name='name']" position="after">
                <field name="subsection_ids"
                       nolabel="1"
                       attrs="{'invisible': [('is_subsection_line', '!=', True)]}">
                    <list editable="bottom">
                        ...
                    </list>
                </field>
            </xpath>

            <xpath expr="//field[@name='order_line']/list/field[@name='name']" position="before">
                <field name="is_subsection_line" invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='order_line']/form//field[@name='name']" position="before">
                <field name="is_subsection_line" invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='order_line']/form/field[@name='name']" position="before">
                <label for="name" string="Subsection Title" invisible="is_subsection_line != True"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/form/field[@name='name']" position="attributes">
                <attribute name="required">is_subsection_line == True</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//field[@name='price_unit']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_subsection_line', '=', True)]}</attribute>
            </xpath>


            <xpath expr="//field[@name='order_line']/list" position="attributes">
                <attribute name="decoration-info">is_subsection_line == True</attribute>
                <attribute name="decoration-muted">display_type == 'line_section'</attribute>
            </xpath>

            <xpath expr="//field[@name='order_line']/list/field[@name='name']" position="attributes">
                <attribute name="t-attf-class">
                    {{
                    record.display_type.raw_value === 'line_section' ? 'fw-bold' :
                    (record.is_subsection_line.raw_value === true ? 'fw-bold fst-italic' : '')
                    }}
                </attribute>
            </xpath>

            <xpath expr="//field[@name='order_line']/list//field[@name='product_template_id']"
                   position="attributes">
                <attribute name="attrs">{'column_invisible': [('is_subsection_line', '=', True)]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/list//field[@name='product_id']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('is_subsection_line', '=', True)]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/list//field[@name='product_uom_qty']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('is_subsection_line', '=', True)]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/list//field[@name='price_unit']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('is_subsection_line', '=', True)]}
                </attribute>
            </xpath>

        </field>
    </record>


</odoo>